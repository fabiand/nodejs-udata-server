<!DOCTYPE html>
<html>
  <head>
    <title>uData</title>
    <met charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
  <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
  </head>
  <body>

    <div style="position: fixed; width: 200px; height: 200px; right: 100px; top: -10px" class="well">
      <div class="container">
        <p class="text-muted" id="reply"></p>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span8">
          <form class="form-inline">
            <legend>Map</legend>
            <div class="control-group">
              <input class="input-small" type="text" placeholder="Key" pattern=".+" required>
              <input class="input-small" type="text" placeholder="Value">
              <div class="btn-group">
                <button type="button" class="btn">Get</button>
                <button type="button" class="btn">Set</button>
                <button type="button" class="btn">Delete Item</button>
              </div>
            </div>
            <div class="control-group">
              <button type="button" class="btn">List Keys</button>
            </div>
          </form>
        </div>
      </div>

    <div class="container">
      <div class="row">
        <div class="span8">
          <form>
            <legend>Object</legend>
            <div class="control-group">
              <input class="input-small" type="text" placeholder="Container" pattern=".+" required>
              <input class="input-small" type="text" placeholder="Object" pattern=".+" required>
              <textarea rows="3" class="span6" placeholder="Data"></textarea>
              <div class="btn-group">
                <button type="button" class="btn">Download</button>
                <button type="button" class="btn">Upload</button>
                <button type="button" class="btn">Delete Object</button>
              </div>
            </div>
            <div class="control-group">
              <button type="button" class="btn">List Containers</button>
              <button type="button" class="btn">List Objects</button>
            </div>
          </form>
        </div>
      </div>

      <div class="row">
        <div class="span8">
          <form class="form-horizontal">
            <legend>Database</legend>
            <div class="control-group">
              <div class="input-append">
                <textarea rows="3" class="span6" placeholder="SQL"></textarea>
                <button type="button" class="btn">Query</button>
              </div>
            </div>
            <div class="control-group">
              <button type="button" class="btn">Schema</button>
            </div>
          </form>
        </div>
      </div>

      <div class="row">
        <div class="span8">
          <form class="form-inline">
            <legend>Push</legend>
            <div class="control-group">
              <div class="input-append">
                <input class="input-small span6" type="text" placeholder="Push URL" required>
                <button type="button" class="btn">Push</button>
              </div>
            </div>
          </form>
        </div>
      </div>

    <script src="assets/jquery-2.0.3.min.js" type="text/javascript"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/udata.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  var namespace = "com.example.nosql",
    key = $("input[placeholder=Key]"),
    value = $("input[placeholder=Value]"),
    sql = $("textarea[placeholder=SQL]"),
    data = $("textarea[placeholder=Data]"),
    pushurl = $("input[placeholder='Push URL']");

  function successfunc(data) {
    console.log("Retrieved: " + data)
    $("#reply").text(JSON.stringify(data))
  }

  function errorfunc(err) {
    console.log("Error: " + JSON.stringify(err))
    $("#reply").text(err.responseText)
  }

  var api = udata.API(),
    connection = api.create_connection();
  $("button:contains('Get')").click(function() {
    /*$.ajax({url: "/api/map/" + key.val(),
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})*/
  })

  $("button:contains('Set')").click(function() {
    $.ajax({url: "/api/map/" + key.val(),
        type: "POST",
        headers: {"X-udata-namespace": namespace},
        data: {value: value.val()},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('Delete Item')").click(function() {
    $.ajax({url: "/api/map/" + key.val(),
        type: "DELETE",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('List Keys')").click(function() {
    $.ajax({url: "/api/map",
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })


  /*
   * Objects
   */
  var container = $("input[placeholder=Container]");
  function objectpath() {
    return container.val() + "/" + encodeURIComponent($("input[placeholder=Object]").val().replace(/\./g, "&dot;"))
  }
  $("button:contains('Download')").click(function() {
    $.ajax({url: "/api/object/" + objectpath(),
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('Upload')").click(function() {
    $.ajax({url: "/api/object/" + objectpath(),
        type: "POST",
        headers: {"X-udata-namespace": namespace},
        contentType: false,
        processData: false,
        data: data.val(),
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('Delete Object')").click(function() {
    $.ajax({url: "/api/object/" + objectpath(),
        type: "DELETE",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('List Containers')").click(function() {
    $.ajax({url: "/api/object",
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('List Objects')").click(function() {
    $.ajax({url: "/api/object/" + container.val(),
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  /*
   * Database
   */
  $("button:contains('Query')").click(function() {
    $.ajax({url: "/api/db",
        type: "POST",
        data: {sql: sql.val()},
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('Schema')").click(function() {
    $.ajax({url: "/api/db/schema",
        type: "GET",
        headers: {"X-udata-namespace": namespace},
        success: successfunc,
        error: errorfunc})
  })

  $("button:contains('Push')").click(function() {
    $.ajax({url: "/push",
        type: "POST",
        headers: {"X-udata-push-url": pushurl.val()},
        success: successfunc,
        error: errorfunc})
  })

  var evtSource = new EventSource("/api/event/request");
  evtSource.addEventListener("request", function(e) {
    var obj = JSON.parse(e.data)
    console.log("EVENT " + JSON.stringify(obj))
  })

})
</script>

  </body>
</html>
